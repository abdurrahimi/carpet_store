import{_ as X,o as n,b as o,e as t,f,m as y,n as m,t as l,E as T,d as c,Q as Z,r as Y,c as u,u as x,w as k,Z as Q,a as i,G as S,F as A,h as O,i as tt,v as at}from"./app-BYybSfoP.js";import{A as et}from"./AuthenticatedLayout-Dh_8t6rk.js";import{M as P}from"./Modal-CQTOB03S.js";import{M as st}from"./vue-multiselect.esm-DOgk8Jhx.js";/* empty css                        */const rt={props:{currentStep:{type:Number,required:!0}},data(){return{steps:["Pembayaran","Gudang","Pengiriman","Selesai"],stepsReject:["Order Dibuat","Ditolak"]}},methods:{nextStep(){this.currentStep<this.steps.length-1&&this.currentStep++},prevStep(){this.currentStep>0&&this.currentStep--}}},nt={class:"container py-5"},ot={class:"stepper d-flex justify-content-between position-relative"},lt={key:0,class:"connector",style:{width:"50%",right:"0px"}},it={class:"con-text"},dt={class:m(["label mt-2","text-primary fw-bold"])},ut={key:0,class:"connector",style:{width:"50%",right:"0px"}};function pt(e,r,p,_,a,d){return n(),o("div",nt,[t("div",ot,[p.currentStep<99?(n(!0),o(f,{key:0},y(a.steps,(v,s)=>(n(),o("div",{key:s,class:"step text-center position-relative flex-fill"},[t("div",{class:m(["circle mx-auto",p.currentStep>=s?"bg-primary text-white":"bg-light"])},l(s+1),3),t("div",{class:m(["label mt-2",p.currentStep>=s?"text-primary fw-bold":"text-muted"])},[t("div",{class:"connector",style:T({background:p.currentStep>=s?"#4e73df":"#dee2e6",width:s==p.currentStep&&s!==3?"50% !important":"100%"})},null,4),p.currentStep==s&&s!==3?(n(),o("div",lt)):c("",!0),t("span",it,l(v),1)],2)]))),128)):(n(!0),o(f,{key:1},y(a.stepsReject,(v,s)=>(n(),o("div",{key:s,class:"step text-center position-relative flex-fill"},[t("div",{class:m(["circle mx-auto",s==0?"bg-primary text-white":"text-white bg-danger border border-danger"])},l(s==1?"X":s+1),3),t("div",dt,[t("div",{class:"connector",style:T({background:s==1?"red":"blue",width:"100%"})},null,4),p.currentStep==s?(n(),o("div",ut)):c("",!0),t("span",{class:"con-text",style:T([s==1?"color:red":""])},l(v),5)])]))),128))])])}const ct=X(rt,[["render",pt],["__scopeId","data-v-d6ef6181"]]),ht=t("div",{class:"text-right"},null,-1),mt={key:0,class:"alert alert-success",role:"alert"},bt={key:1,class:"alert alert-danger",role:"alert"},gt={class:"card shadow"},vt=t("div",{class:"card-header"},[t("h4",{class:"card-title"},[t("i",{class:"fa fa-box"}),i(" Data History Penjualan")])],-1),ft=["onClick"],yt=t("i",{class:"fa fa-print"},null,-1),kt=["onClick"],St=t("i",{class:"fa fa-history"},null,-1),_t=["onClick"],wt=t("i",{class:"fa fa-eye"},null,-1),Tt={class:"col-md-12"},At={class:"table table-bordered"},Pt=t("th",null,"Nama Pelanggan",-1),$t=t("th",null,"Tanggal",-1),Dt=t("th",null,"Toko",-1),jt=t("th",null,"Jumlah",-1),Ct=t("th",null,"Metode Pembayaran",-1),Rt=t("th",null,"Metode Pengiriman",-1),Lt=t("th",null,"Status",-1),Bt={class:"d-flex justify-content-between"},Mt=t("i",{class:"fa fa-history"},null,-1),Nt=t("th",null,"Attachment",-1),Ft={key:0},It=["href"],Gt={class:"table"},Et=t("thead",null,[t("tr",null,[t("th",null,"Produk"),t("th",null,"Jumlah"),t("th",null,"Harga / 6Meter"),t("th",null,"Discount"),t("th",null,"Total")])],-1),Ht={class:"table table-bordered"},Jt=t("thead",null,[t("tr",null,[t("th",null,"Catatan")])],-1),Kt={style:{"font-size":"10px","font-style":"italic"}},Ut=t("br",null,null,-1),Vt={key:0},zt=["href"],Wt=t("br",null,null,-1),qt={key:0},Ot=t("button",{type:"submit",class:"btn btn-primary mt-2"},"Kirim",-1),Qt={key:0},Xt=t("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1),Zt=t("span",{class:"bott"},"Loading",-1),Yt=[Xt,Zt],xt={key:1,class:"bott"},ta={key:0},aa=t("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1),ea=t("span",{class:"bott"},"Loading",-1),sa=[aa,ea],ra={key:1,class:"bott"},na={key:0},oa=t("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1),la=t("span",{class:"bott"},"Loading",-1),ia=[oa,la],da={key:1,class:"bott"},ua={key:0},pa=t("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1),ca=t("span",{class:"bott"},"Loading",-1),ha=[pa,ca],ma={key:1,class:"bott"},ba={layout:et,props:["penjualan"],components:{Head:Q,Modal:P,Multiselect:st},data(){return{lampirkan:!1,lamiran:{description:"",attachment:null},table:[{title:"No. Invoice",data:"invoice_no"},{title:"Nama Pelanggan",data:"customer.name"},{title:"Tanggal",data:"created_at",render:e=>u("span",null,[this.$timeFormat(e.created_at)])},{title:"Toko",data:"store.name"},{title:"Jumlah",data:"final_price"},{title:"Metode Pembayaran",data:"payment_method.name",render:e=>u("span",null,[["Cash","AR","Transfer Bank","Kartu Kredit","Lainnya"][e==null?void 0:e.payment_method]||"N/A"])},{title:"Metode Pengiriman",data:"shipping_method"},{title:"Status",data:"status",render:e=>{switch(parseInt(e.status)){case 0:return u("span",{class:"badge badge-info"},[i("Pending")]);case 1:return u("span",{class:"badge badge-primary"},[i("AR Disetujui")]);case-1:return u("span",{class:"badge badge-info"},[i("AR Sedang Diperiksa")]);case 2:return u("span",{class:"badge badge-primary"},[i("Pembayaran Disetujui")]);case 3:return u("span",{class:"badge badge-primary"},[i("Stock Available Di Warehouse")]);case 4:return u("span",{class:"badge badge-warning"},[i("Stock Tidak Available Di Warehouse")]);case 5:return u("span",{class:"badge badge-info"},[i("Permintaan Barang ke Supplier")]);case 6:return u("span",{class:"badge badge-info"},[i("Pengiriman Barang ke Customer")]);case 7:return u("span",{class:"badge badge-success"},[i("Barang Sudah Diterima Customer")]);case 99:return u("span",{class:"badge badge-danger"},[i("Rejected")]);case 100:return u("span",{class:"badge badge-danger"},[i("Canceled")]);case 101:return u("span",{class:"badge badge-danger"},[i("Invoiced (Unapproved Payment)")]);default:return u("span",{class:"badge badge-light"},[i("Unknown")])}}}],btnTextApprove:["Setujui Pembayaran","Stock Tersedia","Barang Terkirim"],modalTitle:"",modalShow:!1,selectedIds:[],form:{},data:this.data,products:[],store:[],modalShowStatus:!1,approval:{id:null,status:null,data:[],showApprove:!1,showReject:!1,submit:!1},supplier:[{id:2,name:"xx"}],detail:{},status:{0:"Menunggu Persetujuan","-1":"AR Sedang Diperiksa",1:"Permintaan AR Disetujui",2:"Pembayaran Disetujui",3:"Stok Tersedia di Warehouse",4:"Stok Tidak Tersedia di Warehouse",5:"Permintaan Barang ke Supplier",6:"Barang Sedang Dikirim ke Pelanggan",7:"Barang Sudah Diterima Pelanggan",99:"Ditolak",100:"Dibatalkan",101:"Invoiced (Pembayaran Tidak Disetujui)"}}},computed:{currentStep(){switch(parseInt(this.approval.status)){case-1:case 0:return 0;case 1:case 2:return 1;case 3:case 4:case 5:case 6:return 2;case 7:return 3;default:return 99}}},methods:{async submitApproval(e){if(!this.approval.submit){this.approval.submit=!0;try{console.log("Submitting approval:"),S.post(route("order.approve",this.approval.id),this.approval.formData).then(r=>{console.log("success",r.data),r.data.success===!1?this.$error(r.data.message||"Approval gagal"):this.$success("Berhasil mengupdate status"),this.modalShowStatus=!1,this.approval.submit=!1,$("#modal-status-index").modal("hide"),A.visit(this.$page.url,{only:["penjualan"]})}).catch(r=>{console.log("error",r),this.approval.submit=!1,this.$error("Gagal mengupdate status")}).finally(()=>{this.approval.submit=!1})}catch(r){console.error("Error submitting approval:",r),this.approval.submit=!1,this.$error("Gagal mengupdate status")}}},async rejectApproval(){if(!this.approval.submit){this.approval.submit=!0;try{console.log("Submitting approval:"),S.post(route("order.reject",this.approval.id),this.approval.formData).then(e=>{console.log("success",e.data),e.data.success===!1?this.$error(e.data.message||"Approval gagal"):this.$success("Berhasil mengupdate status"),this.modalShowStatus=!1,this.approval.submit=!1,$("#modal-status-index").modal("hide"),A.visit(this.$page.url,{only:["penjualan"]})}).catch(e=>{console.log("error",e),this.approval.submit=!1,this.$error("Gagal mengupdate status")}).finally(()=>{this.approval.submit=!1})}catch(e){console.error("Error submitting approval:",e),this.approval.submit=!1,this.$error("Gagal mengupdate status")}}},async statusLog(e){this.modalShowStatus=!0,this.approval.id=e.id,this.approval.status=e.status;const r=await S.get(route("order.getStatusHistory",{order_id:e.id}));this.approval.data=r.data.data,this.approval.formData={id:e.id,status:e.status},this.handleShowButton(e.status),$("#modal-status-index").modal("show")},async handleSelectedRows(e){this.selectedIds=e.map(r=>r.id)},async handleFile(e){this.form.attachment=e.target.files[0]},async detailTransaksi(e){this.modalShow=!0,this.form=e,this.modalShowStatus=!1;try{const r=await S.get(route("order.detail",e.id));this.detail=r.data.penjualan}catch(r){console.error("Error fetching order details:",r),this.$error("Gagal mengambil detail transaksi")}$("#modal-detail-index").modal("show")},formatMoney(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(isNaN(e)?0:e)},btn1Text(e){switch(e.toString()){case"0":return"Setujui Permintaan";case"-1":return"Setujui Permintaan AR";case"1":case"2":return"Tandai Stock Tersedia";case"3":return"Tandai Sedang Dikirim";case"4":return"Tandai Proses Permintaan ke Supplier";case"5":case"6":return"Tandai Sudah Diterima";default:return"Approve"}},btn2Text(e){switch(e.toString()){case"0":return"Tolak Permintaan";case"-1":return"Tolak Permintaan AR";case"1":case"2":return"Stock Tidak Tersedia";default:return"Reject"}},handleShowButton(e){var p;const r=((p=this.$page.props.auth)==null?void 0:p.role[0])||"guest";switch(this.approval.showApprove=!1,this.approval.showReject=!1,e.toString()){case"0":return(r=="finance"||r=="super_admin")&&(this.approval.showApprove=!0,this.approval.showReject=!0),"Setujui Permintaan";case"-1":return(r=="owner"||r=="super_admin")&&(this.approval.showApprove=!0,this.approval.showReject=!0),"Setujui Permintaan AR";case"1":case"2":return(r=="warehouse"||r=="super_admin")&&(this.approval.showApprove=!0,this.approval.showReject=!0),"Stock Tersedia";case"3":return console.log("role",r),console.log("status",e),(r=="admin"||r=="super_admin")&&(console.log("showApprove"),this.approval.showApprove=!0),"Tandai Sedang Dikirim";case"4":return(r=="admin"||r=="super_admin")&&(this.approval.showApprove=!0),"Tandai Sedang Proses Supplier";case"5":case"6":return(r=="admin"||r=="super_admin")&&(this.approval.showApprove=!0),"Tandai Sudah Diterima";default:return"Approve"}},handleFileLampiran(e){e.target.files.length>0?this.lamiran.attachment=e.target.files[0]:this.lamiran.attachment=null},submitComments(e){const r=new FormData;r.append("description",this.lamiran.description),this.lamiran.attachment&&r.append("attachment",this.lamiran.attachment),A.post(route("order.addAttachment",e),r,{forceFormData:!0,onSuccess:()=>{this.$success("Komentar berhasil dikirim"),this.lamiran.description="",this.lamiran.attachment=null,this.statusLog(this.approval)},onError:p=>{this.$error("Gagal mengirim komentar"),console.error(p)}})},invoice(e){window.open(this.route("invoice.download",e.id),"_blank")}}},Sa=Object.assign(ba,{__name:"History",setup(e){var _;(_=Z().props.auth)!=null&&_.role[0];const p=["Cash","AR","Transfer Bank","Kartu Kredit","Lainnya"];return(a,d)=>{const v=Y("Table");return n(),o("div",null,[u(x(Q),{title:"Data History Penjualan"}),ht,a.$page.props.flash.success?(n(),o("div",mt,l(a.$page.props.flash.success),1)):c("",!0),a.$page.props.flash.error?(n(),o("div",bt,l(a.$page.props.flash.error),1)):c("",!0),t("div",gt,[vt,u(v,{columns:a.table,rows:e.penjualan,"onUpdate:selectedRows":a.handleSelectedRows},{actions:k(({row:s})=>[t("button",{onClick:h=>a.invoice(s),class:"btn btn-success btn-sm",title:"Status Log"},[yt,i("  Invoice")],8,ft),i("  "),t("button",{onClick:h=>a.statusLog(s),class:"btn btn-info btn-sm",title:"Status Log"},[St,i("  Status Log")],8,kt),i("  "),t("button",{onClick:h=>a.detailTransaksi(s),class:"btn btn-warning btn-sm",title:"Detail Transaksi"},[wt,i("  Detail Transaksi")],8,_t),i("  ")]),_:1},8,["columns","rows","onUpdate:selectedRows"])]),u(P,{show:a.modalShow,title:"Detail Transaksi",id:"modal-detail-index"},{default:k(()=>{var s,h,g,D,j,C,R,L,B,M,N,F,I,G,E,H,J,K,U,V,z,W,q;return[t("div",Tt,[t("table",At,[t("thead",null,[t("tr",null,[Pt,t("td",null,l(((h=(s=a.detail)==null?void 0:s.customer)==null?void 0:h.name)??""),1)]),t("tr",null,[$t,t("td",null,l(a.$timeFormat(((g=a.detail)==null?void 0:g.created_at)??!1)),1)]),t("tr",null,[Dt,t("td",null,l(((j=(D=a.detail)==null?void 0:D.store)==null?void 0:j.name)??""),1)]),t("tr",null,[jt,t("td",null,l(a.formatMoney(((C=a.detail)==null?void 0:C.final_price)??0)),1)]),t("tr",null,[Ct,t("td",null,l(p[(R=a.detail)==null?void 0:R.payment_method]||"N/A"),1)]),t("tr",null,[Rt,t("td",null,l((L=a.detail)==null?void 0:L.shipping_method),1)]),t("tr",null,[Lt,t("td",null,[t("div",Bt,[t("span",{class:m(["badge",{"badge-secondary":((B=a.detail)==null?void 0:B.status)===0,"badge-info":((M=a.detail)==null?void 0:M.status)===1||((N=a.detail)==null?void 0:N.status),"badge-primary":((F=a.detail)==null?void 0:F.status)===2,"badge-success":((I=a.detail)==null?void 0:I.status)===3,"badge-warning":((G=a.detail)==null?void 0:G.status)===4,"badge-dark":((E=a.detail)==null?void 0:E.status)===5,"badge-success":((H=a.detail)==null?void 0:H.status)===6,"badge-danger":[99,100,101].includes((J=a.detail)==null?void 0:J.status)}])},l(a.status[(U=(K=a.detail)==null?void 0:K.status)==null?void 0:U.toString()]??"N/A"),3),t("button",{onClick:d[0]||(d[0]=b=>a.statusLog(a.detail)),class:"btn btn-info btn-sm",title:"Status Log"},[Mt,i("  Status Log")])])])]),t("tr",null,[Nt,t("td",null,[((z=(V=a.detail)==null?void 0:V.attachments)==null?void 0:z.length)>0?(n(),o("ul",Ft,[(n(!0),o(f,null,y((W=a.detail)==null?void 0:W.attachments,(b,w)=>(n(),o("li",{key:w},[t("a",{href:`/storage/${b.path}`,target:"_blank"},l(b.name),9,It)]))),128))])):c("",!0)])])])]),t("table",Gt,[Et,t("tbody",null,[(n(!0),o(f,null,y((q=a.detail)==null?void 0:q.order_details,(b,w)=>(n(),o("tr",{key:w},[t("td",null,l(b.product_name),1),t("td",null,l(b.qty)+" meter",1),t("td",null,l(a.formatMoney(b.unit_selling_price)),1),t("td",null,l(b.discount),1),t("td",null,l(a.formatMoney(b.unit_selling_price)),1)]))),128))])])])]}),_:1},8,["show"]),u(P,{show:a.modalShowStatus,title:"Log Status Transaksi",id:"modal-status-index"},{footer:k(()=>{var s,h;return[a.approval.status==3||a.approval.status>5?(n(),o("button",{key:0,type:"button",class:m(["btn btn-warning",{disabled:a.approval.submit}]),onClick:d[6]||(d[6]=g=>a.PrintSuratJalan(!0))},[a.approval.submit?(n(),o("div",Qt,Yt)):(n(),o("span",xt,"Cetak Surat Jalan"))],2)):c("",!0),a.approval.status==4||a.approval.status==5?(n(),o("button",{key:1,type:"button",class:m(["btn btn-danger",{disabled:a.approval.submit}]),onClick:d[7]||(d[7]=g=>a.PrintSuratJalan(!0))},[a.approval.submit?(n(),o("div",ta,sa)):(n(),o("span",ra,"Cetak Dokumen Supplier"))],2)):c("",!0),a.approval.showApprove?(n(),o("button",{key:2,type:"button",class:m(["btn btn-primary",{disabled:a.approval.submit}]),onClick:d[8]||(d[8]=g=>a.submitApproval(!0))},[a.approval.submit?(n(),o("div",na,ia)):(n(),o("span",da,l(a.btn1Text(((s=a.approval)==null?void 0:s.status)??0)),1))],2)):c("",!0),a.approval.showReject?(n(),o("button",{key:3,type:"button",class:m(["btn btn-danger",{disabled:a.approval.submit}]),onClick:d[9]||(d[9]=g=>a.rejectApproval(!1))},[a.approval.submit?(n(),o("div",ua,ha)):(n(),o("span",ma,l(a.btn2Text(((h=a.approval)==null?void 0:h.status)??0)),1))],2)):c("",!0)]}),default:k(()=>[t("form",{ref:"formStatus",onSubmit:d[5]||(d[5]=O((...s)=>a.submitApproval&&a.submitApproval(...s),["prevent"]))},[u(ct,{currentStep:a.currentStep},null,8,["currentStep"]),t("table",Ht,[Jt,t("tbody",null,[(n(!0),o(f,null,y(a.approval.data,(s,h)=>(n(),o("tr",{key:h},[t("td",null,[t("span",Kt,l(a.$timeFormat(s.created_at)),1),Ut,i(" "+l(s.detail)+" ",1),s.attachment?(n(),o("ul",Vt,[t("li",null,[t("a",{href:`/storage/${s.attachment}`,class:"link text-success font-italic",style:{"font-size":"12px"},target:"_blank"},l(s.attachment.split("/").pop()),9,zt)])])):c("",!0),Wt,i(" - ("),t("i",null,l(s.user),1),i(") ")])]))),128)),t("tr",null,[a.lampirkan?(n(),o("td",qt,[t("form",{enctype:"multipart/form-data",onSubmit:d[3]||(d[3]=O(s=>a.submitComments(a.approval.id),["prevent"]))},[tt(t("textarea",{"onUpdate:modelValue":d[1]||(d[1]=s=>a.lamiran.description=s),class:"form-control",rows:"3",placeholder:"Tambahkan catatan..."},null,512),[[at,a.lamiran.description]]),t("input",{type:"file",class:"form-control mt-2",onChange:d[2]||(d[2]=(...s)=>a.handleFileLampiran&&a.handleFileLampiran(...s))},null,32),Ot],32)])):c("",!0)])])]),t("button",{class:m(["btn",[a.lampirkan?"btn-warning":"btn-info"]]),type:"button",onClick:d[4]||(d[4]=()=>a.lampirkan=!a.lampirkan)},l(a.lampirkan?"Batalkan":"Tambah Lampiran"),3)],544)]),_:1},8,["show"])])}}});export{Sa as default};
