import{_ as Z,o as n,b as l,e as t,a as i,t as o,f as v,m as y,n as h,E as T,d as c,Q as Y,r as x,c as u,u as tt,w as k,Z as X,G as S,F as A,h as Q,i as at,v as et}from"./app-KNZD5g8g.js";import{A as st}from"./AuthenticatedLayout-Ey72YXoO.js";import{M as P,a as rt}from"./vue-multiselect.esm-DCI4wgIb.js";/* empty css                        */const nt={props:{currentStep:{type:Number,required:!0}},data(){return{steps:["Pembayaran","Gudang","Pengiriman","Selesai"],stepsReject:["Order Dibuat","Ditolak"]}},methods:{nextStep(){this.currentStep<this.steps.length-1&&this.currentStep++},prevStep(){this.currentStep>0&&this.currentStep--}}},lt={class:"container py-5"},ot={class:"stepper d-flex justify-content-between position-relative"},it={key:0,class:"connector",style:{width:"50%",right:"0px"}},dt={class:"con-text"},ut={class:h(["label mt-2","text-primary fw-bold"])},pt={key:0,class:"connector",style:{width:"50%",right:"0px"}};function ct(e,r,p,_,a,d){return n(),l("div",lt,[t("div",ot,[i(o(p.currentStep)+" ",1),p.currentStep<99?(n(!0),l(v,{key:0},y(a.steps,(f,s)=>(n(),l("div",{key:s,class:"step text-center position-relative flex-fill"},[t("div",{class:h(["circle mx-auto",p.currentStep>=s?"bg-primary text-white":"bg-light"])},o(s+1),3),t("div",{class:h(["label mt-2",p.currentStep>=s?"text-primary fw-bold":"text-muted"])},[t("div",{class:"connector",style:T({background:p.currentStep>=s?"#4e73df":"#dee2e6",width:s==p.currentStep&&s!==3?"50% !important":"100%"})},null,4),p.currentStep==s&&s!==3?(n(),l("div",it)):c("",!0),t("span",dt,o(f),1)],2)]))),128)):(n(!0),l(v,{key:1},y(a.stepsReject,(f,s)=>(n(),l("div",{key:s,class:"step text-center position-relative flex-fill"},[t("div",{class:h(["circle mx-auto",s==0?"bg-primary text-white":"text-white bg-danger border border-danger"])},o(s==1?"X":s+1),3),t("div",ut,[t("div",{class:"connector",style:T({background:s==1?"red":"blue",width:"100%"})},null,4),p.currentStep==s?(n(),l("div",pt)):c("",!0),t("span",{class:"con-text",style:T([s==1?"color:red":""])},o(f),5)])]))),128))])])}const ht=Z(nt,[["render",ct],["__scopeId","data-v-b864ba73"]]),mt=t("div",{class:"text-right"},null,-1),bt={key:0,class:"alert alert-success",role:"alert"},gt={key:1,class:"alert alert-danger",role:"alert"},ft={class:"card shadow"},vt=t("div",{class:"card-header"},[t("h4",{class:"card-title"},[t("i",{class:"fa fa-box"}),i(" Data History Penjualan")])],-1),yt=["onClick"],kt=t("i",{class:"fa fa-history"},null,-1),St=["onClick"],_t=t("i",{class:"fa fa-eye"},null,-1),wt={class:"col-md-12"},Tt={class:"table table-bordered"},At=t("th",null,"Nama Pelanggan",-1),Pt=t("th",null,"Tanggal",-1),Dt=t("th",null,"Toko",-1),$t=t("th",null,"Jumlah",-1),jt=t("th",null,"Metode Pembayaran",-1),Ct=t("th",null,"Metode Pengiriman",-1),Rt=t("th",null,"Status",-1),Lt={class:"d-flex justify-content-between"},Bt=t("i",{class:"fa fa-history"},null,-1),Mt=t("th",null,"Attachment",-1),Ft={key:0},Nt=["href"],Gt={class:"table"},It=t("thead",null,[t("tr",null,[t("th",null,"Produk"),t("th",null,"Jumlah"),t("th",null,"Harga / 6Meter"),t("th",null,"Discount"),t("th",null,"Total")])],-1),Et={class:"table table-bordered"},Ht=t("thead",null,[t("tr",null,[t("th",null,"Catatan")])],-1),Jt={style:{"font-size":"10px","font-style":"italic"}},Kt=t("br",null,null,-1),Ut={key:0},Vt=["href"],zt=t("br",null,null,-1),Wt={key:0},qt=t("button",{type:"submit",class:"btn btn-primary mt-2"},"Kirim",-1),Ot={key:0},Qt=t("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1),Xt=t("span",{class:"bott"},"Loading",-1),Zt=[Qt,Xt],Yt={key:1,class:"bott"},xt={key:0},ta=t("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1),aa=t("span",{class:"bott"},"Loading",-1),ea=[ta,aa],sa={key:1,class:"bott"},ra={key:0},na=t("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1),la=t("span",{class:"bott"},"Loading",-1),oa=[na,la],ia={key:1,class:"bott"},da={key:0},ua=t("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1),pa=t("span",{class:"bott"},"Loading",-1),ca=[ua,pa],ha={key:1,class:"bott"},ma={layout:st,props:["penjualan"],components:{Head:X,Modal:P,Multiselect:rt},data(){return{lampirkan:!1,lamiran:{description:"",attachment:null},table:[{title:"Nama Pelanggan",data:"customer.name"},{title:"Tanggal",data:"created_at",render:e=>u("span",null,[this.$timeFormat(e.created_at)])},{title:"Toko",data:"store.name"},{title:"Jumlah",data:"total"},{title:"Metode Pembayaran",data:"payment_method.name",render:e=>u("span",null,[["Cash","AR","Transfer Bank","Kartu Kredit","Lainnya"][e==null?void 0:e.payment_method]||"N/A"])},{title:"Metode Pengiriman",data:"shipping_method.name"},{title:"Status",data:"status",render:e=>{switch(e.status){case 0:return u("span",{class:"badge badge-info"},[i("Pending")]);case 1:return u("span",{class:"badge badge-primary"},[i("AR Disetujui")]);case-1:return u("span",{class:"badge badge-info"},[i("AR Sedang Diperiksa")]);case 2:return u("span",{class:"badge badge-primary"},[i("Pembayaran Disetujui")]);case 3:return u("span",{class:"badge badge-primary"},[i("Stock Available Di Warehouse")]);case 4:return u("span",{class:"badge badge-warning"},[i("Stock Tidak Available Di Warehouse")]);case 5:return u("span",{class:"badge badge-info"},[i("Permintaan Barang ke Supplier")]);case 6:return u("span",{class:"badge badge-info"},[i("Pengiriman Barang ke Customer")]);case 7:return u("span",{class:"badge badge-success"},[i("Barang Sudah Diterima Customer")]);case 99:return u("span",{class:"badge badge-danger"},[i("Rejected")]);case 100:return u("span",{class:"badge badge-danger"},[i("Canceled")]);case 101:return u("span",{class:"badge badge-danger"},[i("Invoiced (Unapproved Payment)")]);default:return u("span",{class:"badge badge-light"},[i("Unknown")])}}}],btnTextApprove:["Setujui Pembayaran","Stock Tersedia","Barang Terkirim"],modalTitle:"",modalShow:!1,selectedIds:[],form:{},data:this.data,products:[],store:[],modalShowStatus:!1,approval:{id:null,status:null,data:[],showApprove:!1,showReject:!1,submit:!1},supplier:[{id:2,name:"xx"}],detail:{},status:{0:"Menunggu Persetujuan","-1":"AR Sedang Diperiksa",1:"Permintaan AR Disetujui",2:"Pembayaran Disetujui",3:"Stok Tersedia di Warehouse",4:"Stok Tidak Tersedia di Warehouse",5:"Permintaan Barang ke Supplier",6:"Barang Sedang Dikirim ke Pelanggan",7:"Barang Sudah Diterima Pelanggan",99:"Ditolak",100:"Dibatalkan",101:"Invoiced (Pembayaran Tidak Disetujui)"}}},computed:{currentStep(){switch(this.approval.status){case-1:case 0:return 0;case 1:case 2:return 1;case 3:case 4:case 5:case 6:return 2;case 7:return 3;default:return 99}}},methods:{async submitApproval(e){if(!this.approval.submit){this.approval.submit=!0;try{console.log("Submitting approval:"),S.post(route("order.approve",this.approval.id),this.approval.formData).then(r=>{console.log("success",r.data),r.data.success===!1?this.$error(r.data.message||"Approval gagal"):this.$success("Berhasil mengupdate status"),this.modalShowStatus=!1,this.approval.submit=!1,$("#modal-status-index").modal("hide"),A.visit(this.$page.url,{only:["penjualan"]})}).catch(r=>{console.log("error",r),this.approval.submit=!1,this.$error("Gagal mengupdate status")}).finally(()=>{this.approval.submit=!1})}catch(r){console.error("Error submitting approval:",r),this.approval.submit=!1,this.$error("Gagal mengupdate status")}}},async rejectApproval(){if(!this.approval.submit){this.approval.submit=!0;try{console.log("Submitting approval:"),S.post(route("order.reject",this.approval.id),this.approval.formData).then(e=>{console.log("success",e.data),e.data.success===!1?this.$error(e.data.message||"Approval gagal"):this.$success("Berhasil mengupdate status"),this.modalShowStatus=!1,this.approval.submit=!1,$("#modal-status-index").modal("hide"),A.visit(this.$page.url,{only:["penjualan"]})}).catch(e=>{console.log("error",e),this.approval.submit=!1,this.$error("Gagal mengupdate status")}).finally(()=>{this.approval.submit=!1})}catch(e){console.error("Error submitting approval:",e),this.approval.submit=!1,this.$error("Gagal mengupdate status")}}},async statusLog(e){this.modalShowStatus=!0,this.approval.id=e.id,this.approval.status=e.status;const r=await S.get(route("order.getStatusHistory",{order_id:e.id}));this.approval.data=r.data.data,this.approval.formData={id:e.id,status:e.status},this.handleShowButton(e.status),$("#modal-status-index").modal("show")},async handleSelectedRows(e){this.selectedIds=e.map(r=>r.id)},async handleFile(e){this.form.attachment=e.target.files[0]},async detailTransaksi(e){this.modalShow=!0,this.form=e,this.modalShowStatus=!1;try{const r=await S.get(route("order.detail",e.id));this.detail=r.data.penjualan}catch(r){console.error("Error fetching order details:",r),this.$error("Gagal mengambil detail transaksi")}$("#modal-detail-index").modal("show")},formatMoney(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(isNaN(e)?0:e)},btn1Text(e){switch(e.toString()){case"0":return"Setujui Permintaan";case"-1":return"Setujui Permintaan AR";case"1":case"2":return"Tandai Stock Tersedia";case"3":return"Tandai Sedang Dikirim";case"4":return"Tandai Proses Permintaan ke Supplier";case"5":case"6":return"Tandai Sudah Diterima";default:return"Approve"}},btn2Text(e){switch(e.toString()){case"0":return"Tolak Permintaan";case"-1":return"Tolak Permintaan AR";case"1":case"2":return"Stock Tidak Tersedia";default:return"Reject"}},handleShowButton(e){var p;const r=((p=this.$page.props.auth)==null?void 0:p.role[0])||"guest";switch(this.approval.showApprove=!1,this.approval.showReject=!1,e.toString()){case"0":return(r=="finance"||r=="super_admin")&&(this.approval.showApprove=!0,this.approval.showReject=!0),"Setujui Permintaan";case"-1":return(r=="owner"||r=="super_admin")&&(this.approval.showApprove=!0,this.approval.showReject=!0),"Setujui Permintaan AR";case"1":case"2":return(r=="warehouse"||r=="super_admin")&&(this.approval.showApprove=!0,this.approval.showReject=!0),"Stock Tersedia";case"3":return console.log("role",r),console.log("status",e),(r=="admin"||r=="super_admin")&&(console.log("showApprove"),this.approval.showApprove=!0),"Tandai Sedang Dikirim";case"4":return(r=="admin"||r=="super_admin")&&(this.approval.showApprove=!0),"Tandai Sedang Proses Supplier";case"5":case"6":return(r=="admin"||r=="super_admin")&&(this.approval.showApprove=!0),"Tandai Sudah Diterima";default:return"Approve"}},handleFileLampiran(e){e.target.files.length>0?this.lamiran.attachment=e.target.files[0]:this.lamiran.attachment=null},submitComments(e){const r=new FormData;r.append("description",this.lamiran.description),this.lamiran.attachment&&r.append("attachment",this.lamiran.attachment),A.post(route("order.addAttachment",e),r,{forceFormData:!0,onSuccess:()=>{this.$success("Komentar berhasil dikirim"),this.lamiran.description="",this.lamiran.attachment=null,this.statusLog(this.approval)},onError:p=>{this.$error("Gagal mengirim komentar"),console.error(p)}})}}},ya=Object.assign(ma,{__name:"History",setup(e){var _;(_=Y().props.auth)!=null&&_.role[0];const p=["Cash","AR","Transfer Bank","Kartu Kredit","Lainnya"];return(a,d)=>{const f=x("Table");return n(),l("div",null,[u(tt(X),{title:"Data History Penjualan"}),mt,a.$page.props.flash.success?(n(),l("div",bt,o(a.$page.props.flash.success),1)):c("",!0),a.$page.props.flash.error?(n(),l("div",gt,o(a.$page.props.flash.error),1)):c("",!0),t("div",ft,[vt,u(f,{columns:a.table,rows:e.penjualan,"onUpdate:selectedRows":a.handleSelectedRows},{actions:k(({row:s})=>[t("button",{onClick:m=>a.statusLog(s),class:"btn btn-info btn-sm",title:"Status Log"},[kt,i("  Status Log")],8,yt),i("  "),t("button",{onClick:m=>a.detailTransaksi(s),class:"btn btn-warning btn-sm",title:"Detail Transaksi"},[_t,i("  Detail Transaksi")],8,St),i("  ")]),_:1},8,["columns","rows","onUpdate:selectedRows"])]),u(P,{show:a.modalShow,title:"Detail Transaksi",id:"modal-detail-index"},{default:k(()=>{var s,m,g,D,j,C,R,L,B,M,F,N,G,I,E,H,J,K,U,V,z,W,q,O;return[t("div",wt,[t("table",Tt,[t("thead",null,[t("tr",null,[At,t("td",null,o(((m=(s=a.detail)==null?void 0:s.customer)==null?void 0:m.name)??""),1)]),t("tr",null,[Pt,t("td",null,o(a.$timeFormat(((g=a.detail)==null?void 0:g.created_at)??!1)),1)]),t("tr",null,[Dt,t("td",null,o(((j=(D=a.detail)==null?void 0:D.store)==null?void 0:j.name)??""),1)]),t("tr",null,[$t,t("td",null,o(a.formatMoney(((C=a.detail)==null?void 0:C.final_price)??0)),1)]),t("tr",null,[jt,t("td",null,o(p[(R=a.detail)==null?void 0:R.payment_method]||"N/A"),1)]),t("tr",null,[Ct,t("td",null,o((B=(L=a.detail)==null?void 0:L.shipping_method)==null?void 0:B.name),1)]),t("tr",null,[Rt,t("td",null,[t("div",Lt,[t("span",{class:h(["badge",{"badge-secondary":((M=a.detail)==null?void 0:M.status)===0,"badge-info":((F=a.detail)==null?void 0:F.status)===1||((N=a.detail)==null?void 0:N.status),"badge-primary":((G=a.detail)==null?void 0:G.status)===2,"badge-success":((I=a.detail)==null?void 0:I.status)===3,"badge-warning":((E=a.detail)==null?void 0:E.status)===4,"badge-dark":((H=a.detail)==null?void 0:H.status)===5,"badge-success":((J=a.detail)==null?void 0:J.status)===6,"badge-danger":[99,100,101].includes((K=a.detail)==null?void 0:K.status)}])},o(a.status[(V=(U=a.detail)==null?void 0:U.status)==null?void 0:V.toString()]??"N/A"),3),t("button",{onClick:d[0]||(d[0]=b=>a.statusLog(a.detail)),class:"btn btn-info btn-sm",title:"Status Log"},[Bt,i("  Status Log")])])])]),t("tr",null,[Mt,t("td",null,[((W=(z=a.detail)==null?void 0:z.attachments)==null?void 0:W.length)>0?(n(),l("ul",Ft,[(n(!0),l(v,null,y((q=a.detail)==null?void 0:q.attachments,(b,w)=>(n(),l("li",{key:w},[t("a",{href:`/storage/${b.path}`,target:"_blank"},o(b.name),9,Nt)]))),128))])):c("",!0)])])])]),t("table",Gt,[It,t("tbody",null,[(n(!0),l(v,null,y((O=a.detail)==null?void 0:O.order_details,(b,w)=>(n(),l("tr",{key:w},[t("td",null,o(b.product_name),1),t("td",null,o(b.qty)+" meter",1),t("td",null,o(a.formatMoney(b.unit_selling_price)),1),t("td",null,o(b.discount),1),t("td",null,o(a.formatMoney(b.unit_selling_price)),1)]))),128))])])])]}),_:1},8,["show"]),u(P,{show:a.modalShowStatus,title:"Log Status Transaksi",id:"modal-status-index"},{footer:k(()=>{var s,m;return[a.approval.status==3||a.approval.status>5?(n(),l("button",{key:0,type:"button",class:h(["btn btn-warning",{disabled:a.approval.submit}]),onClick:d[6]||(d[6]=g=>a.PrintSuratJalan(!0))},[a.approval.submit?(n(),l("div",Ot,Zt)):(n(),l("span",Yt,"Cetak Surat Jalan"))],2)):c("",!0),a.approval.status==4||a.approval.status==5?(n(),l("button",{key:1,type:"button",class:h(["btn btn-danger",{disabled:a.approval.submit}]),onClick:d[7]||(d[7]=g=>a.PrintSuratJalan(!0))},[a.approval.submit?(n(),l("div",xt,ea)):(n(),l("span",sa,"Cetak Dokumen Supplier"))],2)):c("",!0),a.approval.showApprove?(n(),l("button",{key:2,type:"button",class:h(["btn btn-primary",{disabled:a.approval.submit}]),onClick:d[8]||(d[8]=g=>a.submitApproval(!0))},[a.approval.submit?(n(),l("div",ra,oa)):(n(),l("span",ia,o(a.btn1Text(((s=a.approval)==null?void 0:s.status)??0)),1))],2)):c("",!0),a.approval.showReject?(n(),l("button",{key:3,type:"button",class:h(["btn btn-danger",{disabled:a.approval.submit}]),onClick:d[9]||(d[9]=g=>a.rejectApproval(!1))},[a.approval.submit?(n(),l("div",da,ca)):(n(),l("span",ha,o(a.btn2Text(((m=a.approval)==null?void 0:m.status)??0)),1))],2)):c("",!0)]}),default:k(()=>[t("form",{ref:"formStatus",onSubmit:d[5]||(d[5]=Q((...s)=>a.submitApproval&&a.submitApproval(...s),["prevent"]))},[u(ht,{currentStep:a.currentStep},null,8,["currentStep"]),t("table",Et,[Ht,t("tbody",null,[(n(!0),l(v,null,y(a.approval.data,(s,m)=>(n(),l("tr",{key:m},[t("td",null,[t("span",Jt,o(a.$timeFormat(s.created_at)),1),Kt,i(" "+o(s.detail)+" ",1),s.attachment?(n(),l("ul",Ut,[t("li",null,[t("a",{href:`/storage/${s.attachment}`,class:"link text-success font-italic",style:{"font-size":"12px"},target:"_blank"},o(s.attachment.split("/").pop()),9,Vt)])])):c("",!0),zt,i(" - ("),t("i",null,o(s.user),1),i(") ")])]))),128)),t("tr",null,[a.lampirkan?(n(),l("td",Wt,[t("form",{enctype:"multipart/form-data",onSubmit:d[3]||(d[3]=Q(s=>a.submitComments(a.approval.id),["prevent"]))},[at(t("textarea",{"onUpdate:modelValue":d[1]||(d[1]=s=>a.lamiran.description=s),class:"form-control",rows:"3",placeholder:"Tambahkan catatan..."},null,512),[[et,a.lamiran.description]]),t("input",{type:"file",class:"form-control mt-2",onChange:d[2]||(d[2]=(...s)=>a.handleFileLampiran&&a.handleFileLampiran(...s))},null,32),qt],32)])):c("",!0)])])]),t("button",{class:h(["btn",[a.lampirkan?"btn-warning":"btn-info"]]),type:"button",onClick:d[4]||(d[4]=()=>a.lampirkan=!a.lampirkan)},o(a.lampirkan?"Batalkan":"Tambah Lampiran"),3)],544)]),_:1},8,["show"])])}}});export{ya as default};
